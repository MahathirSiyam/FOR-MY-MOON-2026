<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For My Dearest Moon | 2026</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Playfair+Display:ital,wght@0,700;0,900;1,400&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        :root { --accent: #ff85a2; --dark-bg: #08050a; }
        body { background-color: var(--dark-bg); color: #fff; font-family: 'Poppins', sans-serif; overflow: hidden; height: 100vh; margin: 0; transition: background-color 1s ease; }
        .cursive { font-family: 'Great Vibes', cursive; }
        .serif { font-family: 'Playfair Display', serif; }

        body.warm-glow { background-color: #1a0b0e; }
        .scene { display: none; position: absolute; inset: 0; width: 100%; height: 100vh; flex-direction: column; justify-content: center; align-items: center; padding: 2rem; z-index: 10; }
        .scene.active { display: flex; }

        .premium-title {
            font-family: 'Playfair Display', serif;
            font-weight: 900;
            letter-spacing: 0.15em;
            background: linear-gradient(to bottom, #fff 20%, #ff85a2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1.2;
            text-transform: uppercase;
            filter: drop-shadow(0 10px 15px rgba(0,0,0,0.5));
        }

        .dot { width: 14px; height: 14px; border: 2px solid #ff85a2; border-radius: 50%; transition: 0.3s; }
        .dot.filled { background: #ff85a2; box-shadow: 0 0 10px #ff85a2; }
        .shake { animation: shake 0.4s; }
        @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-10px)} 75%{transform:translateX(10px)} }

        .falling { position: fixed; top: -50px; pointer-events: none; z-index: 5; animation: fall linear infinite; opacity: 0.8; }
        @keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }

        .envelope-wrapper { position: relative; width: 280px; height: 180px; background: #ff4d94; border-radius: 0 0 15px 15px; cursor: pointer; }
        .envelope-flap { position: absolute; top: 0; left: 0; border-left: 140px solid transparent; border-right: 140px solid transparent; border-top: 100px solid #ff7eb9; transform-origin: top; transition: 0.8s; z-index: 30; }
        .letter-paper { position: absolute; top: 10%; left: 10%; width: 80%; height: 80%; background: white; color: #ff4d94; z-index: 20; border-radius: 5px; transition: 1s ease; display: flex; align-items: center; justify-content: center; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .open .envelope-flap { transform: rotateX(180deg); z-index: 10; }
        .open .letter-paper { transform: translateY(-110px); }

        .cake-container { position: relative; width: 220px; height: 200px; transition: filter 0.5s; cursor: default; }
        .lit .cake-container { filter: drop-shadow(0 0 20px rgba(255, 235, 59, 0.4)); }
        .flame { fill: #ffeb3b; opacity: 0; transition: opacity 0.4s; animation: flicker 0.1s infinite alternate; }
        .lit .flame { opacity: 1; }
        @keyframes flicker { from { transform: scale(1); } to { transform: scale(1.1); } }

        /* PHOTO STYLING */
        .photo-card { 
            position: absolute; 
            width: 280px; 
            height: 350px; 
            background: #fff; 
            padding: 10px 10px 45px 10px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); 
            display: flex; 
            flex-direction: column;
            border-radius: 2px;
            cursor: pointer;
            user-select: none;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }
        .photo-card img { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
            background: #eee;
        }
        .photo-card .caption {
            margin-top: 12px;
            color: #ff4d94;
            text-align: center;
            font-size: 1.1rem;
        }

        .btn-fancy { background: linear-gradient(45deg, #ff85a2, #ff4d94); box-shadow: 0 4px 15px rgba(255, 77, 148, 0.3); transition: transform 0.2s; }
        .btn-fancy:active { transform: scale(0.95); }
    </style>
</head>
<body>

    <audio id="snd-chime" src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3"></audio>
    <audio id="snd-blast" src="https://assets.mixkit.co/active_storage/sfx/2017/2017-preview.mp3"></audio>
    <audio id="snd-magic" src="https://assets.mixkit.co/active_storage/sfx/2020/2020-preview.mp3"></audio>
    <audio id="snd-bg" src="https://www.bensound.com/bensound-music/bensound-love.mp3" loop></audio>

    <div id="falling-container"></div>

    <div id="password-screen" class="fixed inset-0 bg-black z-[100] flex flex-col items-center justify-center">
        <h2 class="cursive text-4xl text-pink-400 mb-8">Hello Moon...</h2>
        <div class="flex gap-4 mb-12">
            <div class="dot"></div><div class="dot"></div><div class="dot"></div>
            <div class="dot"></div><div class="dot"></div><div class="dot"></div>
        </div>
        <div class="grid grid-cols-3 gap-6">
            <script>
                for(let i=1; i<=9; i++) document.write(`<button onclick="press(${i})" class="w-16 h-16 rounded-full border border-white/10 text-xl active:bg-pink-500 transition-all">${i}</button>`);
            </script>
            <button onclick="clearPin()" class="text-[10px] uppercase font-bold text-pink-400">Clear</button>
            <button onclick="press(0)" class="w-16 h-16 rounded-full border border-white/10 text-xl">0</button>
        </div>
    </div>

    <section id="scene-1" class="scene">
        <div class="bg-white/5 backdrop-blur-xl p-10 rounded-[3rem] text-center border border-white/10 max-w-sm">
            <h1 class="cursive text-5xl text-pink-400 mb-6">Happy Birthday Moon! ü•≥‚ú®</h1>
            <button onclick="startApp()" class="btn-fancy px-10 py-4 rounded-full font-bold uppercase text-xs tracking-widest text-white">Open the Magic</button>
        </div>
    </section>

    <section id="scene-2" class="scene">
        <h2 class="serif text-xl tracking-[0.3em] mb-4 text-pink-200 uppercase opacity-70">Starting in...</h2>
        <div id="timer" class="cursive text-pink-400 text-[10rem]"></div>
    </section>

    <section id="scene-bigwish" class="scene">
        <div class="text-center px-4">
            <h1 id="reveal-text" class="premium-title text-6xl md:text-8xl mb-8">HAPPY<br>BIRTHDAY<br>BABY</h1>
            <div class="h-1 w-24 bg-pink-500 mx-auto mb-8"></div>
            <p class="serif italic text-pink-100/60 text-lg tracking-widest mb-12">YOU ARE MY WORLD ‚ù§Ô∏è</p>
            <button onclick="toScene('scene-3')" class="btn-fancy px-12 py-4 rounded-full font-bold uppercase text-xs tracking-[0.2em] text-white">Open My Message</button>
        </div>
    </section>

    <section id="scene-3" class="scene">
        <h2 class="cursive text-4xl text-pink-300 mb-20">A Special Message üíå</h2>
        <div id="envelope" class="envelope-wrapper" onclick="openEnv()">
            <div class="envelope-flap"></div>
            <div class="letter-paper cursive text-2xl">For My Moon</div>
        </div>
    </section>

    <section id="scene-4" class="scene">
        <div class="bg-white/5 backdrop-blur-xl p-8 rounded-[2rem] max-w-sm border border-white/10 text-center">
            <h2 class="cursive text-3xl text-pink-400 mb-4">My dearest Moon,</h2>
            <div class="serif text-base leading-relaxed text-pink-50/80 space-y-3">
                <p>Happy birthday Moon. It's almost <span class="text-pink-400 font-bold">5 years</span> since we met.</p>
                <p>You've been the special one since day one. I love you the most.</p>
            </div>
            <button onclick="toScene('scene-wish')" class="btn-fancy mt-6 w-full py-3 rounded-xl font-bold text-white">MAKE A WISH üåô</button>
        </div>
    </section>

    <section id="scene-wish" class="scene">
        <h2 class="cursive text-6xl text-pink-300 mb-6 text-center">Close your eyes...</h2>
        <p class="serif text-pink-100 italic mb-12 opacity-80">And make a beautiful wish, Moon.</p>
        <button onclick="toScene(5)" class="btn-fancy px-12 py-4 rounded-full font-bold uppercase text-xs text-white">I have made my wish ‚ú®</button>
    </section>

    <section id="scene-5" class="scene">
        <h2 class="cursive text-4xl text-pink-300 mb-10 text-center">Now, let's light up the day!</h2>
        <div class="cake-container" id="cake-stage">
            <div class="cake-half"><svg viewBox="0 0 200 200"><rect x="20" y="100" width="160" height="70" fill="#f48fb1" rx="10"/><rect x="40" y="60" width="120" height="50" fill="#f06292" rx="10"/><rect fill="#ce93d8" x="70" y="30" width="6" height="30" rx="2"/><rect fill="#ce93d8" x="100" y="25" width="6" height="35" rx="2"/><rect fill="#ce93d8" x="130" y="30" width="6" height="30" rx="2"/><path class="flame" d="M73 15c-3 0-4 4-4 7s2 8 4 8 4-5 4-8-1-7-4-7z"/><path class="flame" d="M103 10c-3 0-4 4-4 7s2 8 4 8 4-5 4-8-1-7-4-7z"/><path class="flame" d="M133 15c-3 0-4 4-4 7s2 8 4 8 4-5 4-8-1-7-4-7z"/></svg></div>
        </div>
        <div class="mt-12 w-64">
            <button id="btn-light" onclick="lightCandles()" class="bg-orange-500 w-full py-4 rounded-full font-bold uppercase text-xs text-white">Light Candles üïØÔ∏è</button>
        </div>
    </section>

    <section id="scene-blow" class="scene">
        <h2 class="cursive text-4xl text-pink-300 mb-10 text-center">Make it come true...</h2>
        <div class="cake-container lit" id="cake-blow-stage" onclick="handleCakeTouch()">
            <div class="cake-half"><svg viewBox="0 0 200 200"><rect x="20" y="100" width="160" height="70" fill="#f48fb1" rx="10"/><rect x="40" y="60" width="120" height="50" fill="#f06292" rx="10"/><rect fill="#ce93d8" x="70" y="30" width="6" height="30" rx="2"/><rect fill="#ce93d8" x="100" y="25" width="6" height="35" rx="2"/><rect fill="#ce93d8" x="130" y="30" width="6" height="30" rx="2"/><path class="flame" style="opacity:1" d="M73 15c-3 0-4 4-4 7s2 8 4 8 4-5 4-8-1-7-4-7z"/><path class="flame" style="opacity:1" d="M103 10c-3 0-4 4-4 7s2 8 4 8 4-5 4-8-1-7-4-7z"/><path class="flame" style="opacity:1" d="M133 15c-3 0-4 4-4 7s2 8 4 8 4-5 4-8-1-7-4-7z"/></svg></div>
        </div>
        <div class="mt-12 w-64">
            <div id="mic-hint" class="text-pink-300 text-sm animate-pulse serif italic text-center">Blow on the microphone! üå¨Ô∏è</div>
            <button id="btn-cut" onclick="toScene(6)" class="hidden btn-fancy w-full py-4 rounded-full font-bold uppercase text-xs text-white">Cut the Cake üç∞</button>
        </div>
    </section>

    <section id="scene-6" class="scene">
        <div class="relative w-full h-full flex flex-col items-center justify-center">
            <div id="gallery" class="relative w-[280px] h-[350px]" onclick="shuffleGallery()">
                <div class="photo-card"><img src="photo8.jpg"><div class="caption cursive">Infinity</div></div>
                <div class="photo-card"><img src="photo7.jpg"><div class="caption cursive">My Peace</div></div>
                <div class="photo-card"><img src="photo6.jpg"><div class="caption cursive">Magic</div></div>
                <div class="photo-card"><img src="photo5.jpg"><div class="caption cursive">Always You</div></div>
                <div class="photo-card"><img src="photo4.jpg"><div class="caption cursive">Forever</div></div>
                <div class="photo-card"><img src="photo3.jpg"><div class="caption cursive">My World</div></div>
                <div class="photo-card"><img src="photo2.jpg"><div class="caption cursive">Pure Joy</div></div>
                <div class="photo-card"><img src="photo1.jpg"><div class="caption cursive">The Beginning</div></div>
            </div>
            <p class="mt-16 text-pink-200/50 text-[10px] uppercase tracking-widest animate-pulse">Tap photo to shuffle üåô</p>
            <button onclick="toScene(7)" class="btn-fancy mt-8 px-8 py-3 rounded-xl text-xs font-bold uppercase text-white">Final Message üëë</button>
        </div>
    </section>

    <section id="scene-7" class="scene text-center px-6">
        <h2 class="cursive text-4xl text-pink-400 mb-4">Dearest Mrs Siyam,</h2>
        <p class="serif text-base text-pink-50 mb-8 max-w-xs mx-auto">Watching you grow has been my greatest joy. I love you endlessly.</p>
        <div class="flex items-center justify-center gap-4">
            <button onclick="finalBlast()" class="bg-red-500 px-6 py-3 rounded-full font-bold uppercase text-[10px] tracking-wider text-white">Seal with Love üåπ</button>
            <button onclick="location.reload()" class="border border-pink-400/30 px-6 py-3 rounded-full font-bold uppercase text-[10px] tracking-wider">Restart üîÑ</button>
        </div>
    </section>

    <script>
        const chime = document.getElementById('snd-chime');
        const blast = document.getElementById('snd-blast');
        const magic = document.getElementById('snd-magic');
        const bgMusic = document.getElementById('snd-bg');
        let currentPin = "";
        const targetPin = "230623";
        let candlesOut = false;

        function press(n) {
            if (currentPin.length < 6) {
                currentPin += n; chime.currentTime = 0; chime.play();
                document.querySelectorAll('.dot')[currentPin.length - 1].classList.add('filled');
                if (currentPin.length === 6) {
                    if (currentPin === targetPin) {
                        magic.play(); gsap.to("#password-screen", { y: "-100%", duration: 0.8, onComplete: () => {
                            document.getElementById('password-screen').style.display = 'none';
                            document.getElementById('scene-1').classList.add('active');
                        }});
                    } else { document.getElementById('password-screen').classList.add('shake'); setTimeout(clearPin, 500); }
                }
            }
        }
        function clearPin() { currentPin = ""; document.querySelectorAll('.dot').forEach(d => d.classList.remove('filled')); document.getElementById('password-screen').classList.remove('shake'); }

        function toScene(id) {
            gsap.to(".scene.active", { opacity: 0, duration: 0.4, onComplete: () => {
                document.querySelectorAll('.scene').forEach(s => s.classList.remove('active'));
                const target = typeof id === 'string' ? document.getElementById(id) : document.getElementById(`scene-${id}`);
                target.classList.add('active');
                gsap.fromTo(target, { opacity: 0, scale: 0.95 }, { opacity: 1, scale: 1, duration: 0.5 });
                if(id === 'scene-6') setupGalleryZIndex();
                if(id === 'scene-bigwish') gsap.from("#reveal-text", { y: 50, opacity: 0, duration: 1, ease: "power4.out", delay: 0.3 });
            }});
        }

        function startApp() {
            bgMusic.play().catch(() => {}); toScene(2);
            let count = 5; 
            const timerInt = setInterval(() => {
                chime.currentTime = 0; chime.play();
                document.getElementById('timer').innerText = count; 
                gsap.fromTo("#timer", { scale: 0 }, { scale: 1, duration: 0.5 });
                count--;
                if (count < 0) { clearInterval(timerInt); setTimeout(() => { blast.play(); confetti({ particleCount: 200 }); toScene('scene-bigwish'); }, 1000); }
            }, 1200);
        }

        function openEnv() { magic.play(); document.getElementById('envelope').classList.add('open'); setTimeout(() => toScene(4), 1800); }
        function lightCandles() { magic.play(); document.body.classList.add('warm-glow'); toScene('scene-blow'); initMic(); }

        async function initMic() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                const audioContext = new AudioContext();
                const analyser = audioContext.createAnalyser();
                const mic = audioContext.createMediaStreamSource(stream);
                mic.connect(analyser);
                const data = new Uint8Array(analyser.frequencyBinCount);
                function detect() {
                    analyser.getByteFrequencyData(data);
                    if (data.reduce((a,b)=>a+b)/data.length > 55) { blowOut(); stream.getTracks().forEach(t=>t.stop()); }
                    else if (!candlesOut) { requestAnimationFrame(detect); }
                }
                detect();
            } catch (e) { document.getElementById('mic-hint').innerHTML = "Mic blocked? <span onclick='blowOut()'>Tap Cake to Blow</span>"; }
        }

        function blowOut() {
            candlesOut = true; document.body.classList.remove('warm-glow'); blast.play();
            document.querySelectorAll('.flame').forEach(f => f.style.opacity = "0");
            document.getElementById('mic-hint').classList.add('hidden');
            document.getElementById('btn-cut').classList.remove('hidden');
            confetti({ particleCount: 200 });
        }

        function handleCakeTouch() { if(candlesOut) toScene(6); else blowOut(); }

        // AUTOMATIC Z-INDEX SETUP
        function setupGalleryZIndex() {
            const cards = document.querySelectorAll('.photo-card');
            cards.forEach((card, index) => {
                card.style.zIndex = cards.length - index;
            });
        }

        function shuffleGallery() {
            const cards = Array.from(document.querySelectorAll('.photo-card'));
            const topCard = cards.reduce((prev, curr) => (parseInt(prev.style.zIndex) > parseInt(curr.style.zIndex)) ? prev : curr);
            
            chime.currentTime = 0; chime.play();
            
            gsap.to(topCard, {
                x: 350, rotation: 25, opacity: 0, duration: 0.5,
                onComplete: () => {
                    cards.forEach(card => {
                        let z = parseInt(card.style.zIndex);
                        card.style.zIndex = z + 1;
                    });
                    topCard.style.zIndex = "1";
                    gsap.set(topCard, { x: 0, rotation: 0, opacity: 1 });
                }
            });
        }

        function finalBlast() { blast.play(); confetti({ particleCount: 500, spread: 150 }); setTimeout(() => { alert("Happy Birthday Moon!"); }, 500); }

        setInterval(() => {
            const el = document.createElement('div'); el.className = 'falling';
            el.innerText = ['‚ù§Ô∏è', '‚ú®', 'üåô', 'üå∏'][Math.floor(Math.random()*4)];
            el.style.left = Math.random() * 100 + 'vw';
            el.style.fontSize = (Math.random() * 20 + 15) + 'px';
            el.style.animationDuration = (Math.random() * 3 + 4) + 's';
            document.getElementById('falling-container').appendChild(el);
            setTimeout(() => el.remove(), 7000);
        }, 500);
    </script>
</body>
</html>
